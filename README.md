# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Карточка товара 

```
export interface IProductItem {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
  index: number;
}
```

Данные покупателя

```
export interface IBuyer {
  orderId: string;
  payment: TPaymentMethod;
  address: string;
  email: string;
  phone: string;
  clearBuyerData(): void;
  getOrderInfo(): TOrderInfo;
  checkPaymentValidation(): void;
  checkContactsValidation(): void;
}
```

Интерфейс для модели данных корзины товаров

```
export interface IBasket {
  items: IProductItem[];
  total: number;
  count: number;
  addItem(item: IProductItem): void;
  removeItem(id: string): void;
  clearBasket(): void;
  checkItem(id: string): boolean;
  getOrderItems(): IProductItem[];
}
```

Интерфейс для модели данных карточек товара

```
export interface IProductList {
  items: IProductItem[];
  getProduct(id: string): IProductItem | undefined;
}
```

Интерфейс для работы с API

```
export interface IApi {
  baseUrl: string;
  get<T>(uri: string): Promise<T>;
  post<T>(uri: string, data: object, method?: ApiPostMethods): Promise<T>;
}
```

Интерфейс для ответа сервера

```
export interface IOrderResponse {
  id?: string;
  total?: number;
  error?: string;
}
```

Данные заказа

```
export type TOrderInfo = Pick<IBuyer, 'payment' | 'address' | 'email' | 'phone'>
```

Способ оплаты 

```
export type TPaymentMethod = 'online' | 'offline' | null;
```

Методы запросов для работы с сервером 

```
export type TApiPostMethods = 'POST' | 'PUT' | 'DELETE' | 'PATCH';
```

Категория товара 

```
export type TProductCategory = 'софт-скил' | 'хард-скил' | 'другое' | 'кнопка' | 'дополнительное';
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- get - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- post - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом IEvents:
- on - подписка на событие
- emit - инициализация события
- trigger - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс ProductsData
Класс отвечает за хранение и логику работы с данными карточек товара.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- _items: IProductItem[] - массив объектов карточек товара
- events: IEvents - экземпляр класса EventEmitter для инициации событий при изменении данных

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- getProduct(id: string): IProductItem | undefined - получить карточку товара по id, используется для получения при рендере списков
- set items(items: IProductItem[]) - сеттер, который используется для установления после загрузки из апи
- get items(): IProductItem[] - геттер для получения карточек товаров

#### Класс BuyerData
Класс отвечает за хранение и логику работы с данными о заказе.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- _orderId: string - id заказа
- _payment: string - способ оплаты, выбранный пользователем
- _address: string - адрес доставки, введенный пользователем
- _email: string - адрес электронной почты, введенный пользователем
- _phone: number - номер телефона, введенный пользователем
- events: IEvents - экземпляр класса EventEmitter для инициации событий при изменении данных

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- set orderId(id: string) - сеттер, который используется для установки id заказа
- get payment(): TPaymentMethod - геттер, который возвращает способ оплаты
- set payment(payment: TPaymentMethod) - сеттер, который используется для установки способа оплаты
- get address(): string - геттер, который возвращает адрес
- set address(address: string) - сеттер, который используется для установки адреса
- get email(): string - геттер, который возвращает email
- set email(email: string) - сеттер, который используется для установки email
- get phone(): string - геттер, который возвращает номер телефона
- set phone(phone: string) - сеттер, который используется для установки номера телефона
- clearBuyerData(): void - очищает данные заказа
- getOrderInfo(): TOrderInfo - возвращает объект с данными заказа
- checkPaymentValidation(): void - валидирует форму со способом оплаты и адресом, генирирует соответсвующее событие
- checkContactsValidation(): void - валидирует форму с адресом электронной почты и номером телефона, генирирует соответсвующее событие

#### Класс BasketData
Класс отвечает за хранение и логику работы с данными корзины товаров.\
Конструктор класса принимает инстанс брокера событий.\
В полях класса хранятся следующие данные:
- _items: IProductItem[] - массив объектов товаров
- _total: number - общая стоимость товаров в корзине
- _count: number - количество товаров в корзине
- events: IEvents - экземпляр класса EventEmitter для инициации событий при изменении данных

Класс предоставляет следующие методы:
- addItem(item: IProductItem): void - добавляет товар в корзину
- removeItem(id: string): void - удаляет товар из корзины по id
- clearBasket(): void - полностью очищает корзину
- checkItem(id: string): boolean - возвращает true, если товар с этим id уже есть в корзине
- get items(): IProductItem[] - геттер, который возвращает массив товаров в корзине
- get total: number - геттер, который возвращает общую стоимость
- get count: number - геттер, который возвращает количество товаров
- getOrderItems(): IProductItem[] - возвращает массив товаров в корзине, кроме бесценного товара для отправки на сервер

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Component
Родительский класс для компонентов слоя представления.\
Принимает элемент разметки в конструткор.\

Методы:
- render(data?: Partial<T>): HTMLElement - метод для отрисовки
- changeButtonState(button: HTMLButtonElement, state: boolean): void - отвечает за управление состоянием кнопки (добавление или удаление атрибута disabled)

#### Класс Modal 
Реализует модальное окно. Так же предоставляет методы open и close для управления отображением модального окна. Устанавливает слушатели на клик в оверлей и кнопку-крестик для закрытия модального окна.\
В конструктор класса передается экземпляр класса EventEmitter для возможности инициации событий, а также DOM элемент темплейта, что позволяет при необходимости формировать модальные окна разных вариантов верстки.

Поля класса: 
- _content: HTMLElement - элемент темплейта модального окна
- events: IEvents - брокер событий
- closeButton: HTMLButtonElement - кнопка закрытия модального окна

Методы:
- open(): void - открывает модальное окно
- close(): void - закрывает модальное окно
- set сontent(content: HTMLElement): void - сеттер, который заменяет текущий контент модального окна

#### Класс MainPage
Отвечает за отображение главной страницы с товарами.

Поля класса:
- _productItems: HTMLElement - контейнер товаров
- basketButton: HTMLButtonElement - кнопка корзины
- _basketCounter - HTMLSpanElement - счетчик товаров на кнопке с корзиной
- pageWrapper: HTMLDivElement - обертка страницы
- events: IEvents - брокер событий

Методы:
- set productItems (items: HTMLElement[]) - сеттер, используемый для установки карточек с товарами
- set basketCounter (value: number) - сеттер, и используемый для установки счетчика корзины
- set scrollLock (state: boolean) - сеттер, используемый для управления блокировкой прокрутки страницы при открытом модальном окне

#### Класс ProductItem
Основной класс, отвечающий за отображение карточки, задает в карточке данные названия, стоимости и id. Класс используется для отображения карточек на сайте. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки.\
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр EventEmitter для инициации событий.\

Методы:
- set title (title: string) - сеттер, который используется для установки названия товара
- set price (price: number | null) - сеттер, который используется для установки цены на товар
- set id (id) - сеттер, который используется для установки id карточки товара
- get id() - геттер, который возвращает уникальный id карточки
- deleteProduct(): void - метод для удаления разметки карточки

#### Класс ProductCatalog
Класс отвечает за карточку товара на главной странице сайта. Наследуется от класса ProductItem.\
В классе устанавливается слушатель на клик по карточке товара для открытия модального окна с этим товаром, в результате взаимодействия с карточкой генерируется соответствующее событие.

Методы:
- set image (image: string) - сеттер, используемый для установки изображения товара
- set category (category: TProductCategory) - сеттер, используемый для установки категории товара

#### Класс ProductPreview
Отвечает за модальное окно просмотра товара. Наследуется от класса ProductItem.\
В классе устанавливается слушатель на клик по кнопке добавления этого товара в корзину, в результате чего генерируется соответствующее событие.

Методы:
- set image (image: string) - сеттер, используемый для установки изображения товара
- set category (category: TProductCategory) - сеттер, используемый для установки категории товара
- set description (description: string) - сеттер, используемый для установки описания товара
- set buttonState (state: boolean) - сеттер, используемый для управления состоянием кнопки добавления товара в корзину

#### Класс ProductBasket
Отвечает за карточку товара в корзине. Наследуется от класса ProductItem.\
В классе устанавливается слушатель на клик по кнопке удаления этого товара из корзины, в результате чего генерируется соответствующее событие.

Методы:
- set index (index: number) - сеттер для установки индекса товара в корзине

#### Класс BasketModal
Класс отвечает за модальное окно с корзиной.\
В классе устанавливается слушатель на клик по кнопке для оформления заказа, в результате чего генерируется соответствующее событие.

Поля класса:
- _productsContainer: HTMLUListElement - элемент списка карточек товаров в корзине
-  _totalContainer: HTMLSpanElement - элемент общей стоимости товаров в корзине
- submitButton: HTMLButtonElement - кнопка для оформления заказа
- events: IEvents - брокер событий

Методы:
- set productsContainer(items: HTMLElement[]) - сеттер для установки товаров в корзине
- set totalContainer(total: number) - сеттер для установки итоговой суммы заказа

#### Класс FormModal
Родительский класс для компонентов модальных окон с формами.\ Наследуется от класса Component.\
В классе устанавливаются слушатели на клики по кнопкам submit, и на ввод пользователем данных в инпуты, в результате чего генерируется соответствующие события.

#### Класс PaymentModal
Отвечает за модальное окно с формой с выбором способа оплаты и доставки. Наследуется от класса FormModal.\
В классе устанавливаются слушатели на клики по кнопкам выбора оплаты, в результате чего генерируется соответствующие события.

Поля класса:
- addressInput: HTMLInputElement - инпут для ввода адреса доставки
- onlineButton: HTMLButtonElement - кнопка оплаты онлайн
- offlineButton: HTMLButtonElement - кнопка оплаты по карте
- paymentMethod: TPaymentMethod - выбранный способ оплаты

Методы:
- set address(address: string): string - сеттер для адреса доставки
- set payment(method: TPaymentMethod) - сеттер для способа оплаты

#### Класс ContactsModal
Отвечает за модальное окно с формой ввода адреса электронной почты и номера телефона. Наследуется от класса FormModal.\

Поля класса:
- emailInput: HTMLInputElement - инпут для ввода адреса электронной почты
- phoneInput: HTMLInputElement - инпут для ввода номера телефона

Методы:
- set email (email: string) - сеттер для адреса электронной почты
- set phone (phone: string) - сеттер для номера телефона

#### Класс SuccessModal
Отвечает за модальное окно с информацией об успешном заказе.\

Поля класса:
- HTMLParagraphElement - сообщение о списании суммы заказа
- title: HTMLHeadingElement - заголовок модального окна
- submitButton: HTMLButtonElement - кнопка "За новыми покупками!"
- events: IEvents - брокер событий

Методы:
- set total (total: number) - сеттер для установки общей суммы заказа

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле index.ts, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*

*События изменения данных (генерируются классами моделями данных)*
- products:changed - изменение массива карточек с товарами
- payment:validation - изменение данных способа оплаты или адреса доставки
- contacts:validation - изменение данных адреса электронной почты или номера телефона

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- product:select - выбор карточки товара для отображения в модальном окне
- product:add - добавление товара в корзину
- product:delete - удаление товара из корзины
- modal:open - открытие модальных окон
- modal:close - закрытие модальных окон
- basket:open - открытие модального окна с корзиной
- basket:submit - нажатие кнопки "Оформить" в корзине с товарами
- order:select - выбор способа оплаты
- address:input - изменение адреса доставки
- order:submit - нажатие кнопки "Далее" в форме со способом оплаты и адресом доставки
- email:input - изменение адреса электронной почты
- phone:input - изменение номера телефона
- contacts:submit - нажатие кнопки "Оплатить" в форме с адресом электронной почты и номером телефона
- success:submit - нажатие кнопки "За новыми покупками!" в модальном окне успешной покупки